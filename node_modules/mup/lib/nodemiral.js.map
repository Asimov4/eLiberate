{"version":3,"sources":["../src/nodemiral.js"],"names":["copy","session","_options","callback","options","retries","hostVars","_host","vars","doCopy","src","dest","cb","err","console","log","setTimeout","registerTask"],"mappings":";;8QAAA;;;AACA;;;;AACA;;;;AAEA,SAASA,IAAT,CAAcC,OAAd,EAAuBC,QAAvB,EAAiCC,QAAjC,EAA2C;AACzC,MAAMC,UAAU,mBAAMF,QAAN,CAAhB;AACA,MAAIG,UAAU,CAAd;;AAEA,MAAI,QAAOD,QAAQE,QAAf,MAA4B,QAA5B,IAAwCF,QAAQE,QAAR,CAAiBL,QAAQM,KAAzB,CAA5C,EAA6E;AAC3EH,YAAQI,IAAR,GAAe,mBAAMJ,QAAQI,IAAd,EAAoBJ,QAAQE,QAAR,CAAiBL,QAAQM,KAAzB,CAApB,CAAf;AACD;;AAED,WAASE,MAAT,GAAkB;AAChBR,YAAQD,IAAR,CAAaI,QAAQM,GAArB,EAA0BN,QAAQO,IAAlC,EAAwCP,OAAxC,EAAiDQ,EAAjD;AACD;AACD,WAASA,EAAT,CAAYC,GAAZ,EAAiB;AACf,QAAIA,OAAOR,UAAU,CAArB,EAAwB;AACtBS,cAAQC,GAAR,CAAY,sBAAZ,EAAoCF,GAApC;AACAC,cAAQC,GAAR,CAAY,uBAAZ;;AAEAC,iBAAWP,MAAX,EAAmB,IAAnB;AACA;AACD;AACDN,aAASU,GAAT;AACD;;AAEDJ;AACD;;AAED,oBAAUQ,YAAV,CAAuB,MAAvB,EAA+BjB,IAA/B","file":"nodemiral.js","sourcesContent":["// Registers additional nodemiral tasks\nimport nodemiral from 'nodemiral';\nimport { clone, merge } from 'lodash';\n\nfunction copy(session, _options, callback) {\n  const options = clone(_options);\n  let retries = 0;\n\n  if (typeof options.hostVars === 'object' && options.hostVars[session._host]) {\n    options.vars = merge(options.vars, options.hostVars[session._host]);\n  }\n\n  function doCopy() {\n    session.copy(options.src, options.dest, options, cb);\n  }\n  function cb(err) {\n    if (err && retries < 3) {\n      console.log('Failed to copy file ', err);\n      console.log('Retrying in 3 seconds');\n\n      setTimeout(doCopy, 3000);\n      return;\n    }\n    callback(err);\n  }\n\n  doCopy();\n}\n\nnodemiral.registerTask('copy', copy);\n"]}