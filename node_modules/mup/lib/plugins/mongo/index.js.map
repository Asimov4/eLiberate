{"version":3,"sources":["../../../src/plugins/mongo/index.js"],"names":["prepareConfig","_commands","description","commands","validate","mongo","config","app","env","name","split","join","docker","args","push","hooks","api","getConfig","runCommand","then"],"mappings":";;;;;;QAUgBA,a,GAAAA,a;;AAVhB;;IAAYC,S;;AAEZ;;;;;;;;AAEO,IAAMC,oCAAc,4BAApB;AACA,IAAIC,8BAAWF,SAAf;AACA,IAAMG,8BAAW;AACtBC;AADsB,CAAjB;;AAIA,SAASL,aAAT,CAAuBM,MAAvB,EAA+B;AACpC,MAAI,CAACA,OAAOC,GAAR,IAAe,CAACD,OAAOD,KAA3B,EAAkC;AAChC,WAAOC,MAAP;AACD;;AAEDA,SAAOC,GAAP,CAAWC,GAAX,GAAiBF,OAAOC,GAAP,CAAWC,GAAX,IAAkB,EAAnC;AACAF,SAAOC,GAAP,CAAWC,GAAX,CAAe,WAAf,iCAAyDF,OAAOC,GAAP,CAAWE,IAAX,CAAgBC,KAAhB,CAAsB,GAAtB,EAA2BC,IAA3B,CAAgC,EAAhC,CAAzD;;AAEA,MAAI,CAACL,OAAOC,GAAP,CAAWK,MAAhB,EAAwB;AACtBN,WAAOC,GAAP,CAAWK,MAAX,GAAoB,EAApB;AACD;;AAED,MAAI,CAACN,OAAOC,GAAP,CAAWK,MAAX,CAAkBC,IAAvB,EAA6B;AAC3BP,WAAOC,GAAP,CAAWK,MAAX,CAAkBC,IAAlB,GAAyB,EAAzB;AACD;;AAEDP,SAAOC,GAAP,CAAWK,MAAX,CAAkBC,IAAlB,CAAuBC,IAAvB,CAA4B,wBAA5B;AACD;;AAEM,IAAMC,wBAAQ;AACnB,sBADmB,4BACEC,GADF,EACO;AACxB,QAAMV,SAASU,IAAIC,SAAJ,EAAf;AACA,QAAIX,OAAOD,KAAX,EAAkB;AAChB,aAAOW,IAAIE,UAAJ,CAAe,aAAf,EAA8BC,IAA9B,CAAmC;AAAA,eAAMH,IAAIE,UAAJ,CAAe,aAAf,CAAN;AAAA,OAAnC,CAAP;AACD;AACF;AANkB,CAAd","file":"index.js","sourcesContent":["import * as _commands from './commands';\n\nimport _validator from './validate';\n\nexport const description = 'Commands to manage MongoDB';\nexport let commands = _commands;\nexport const validate = {\n  mongo: _validator\n};\n\nexport function prepareConfig(config) {\n  if (!config.app || !config.mongo) {\n    return config;\n  }\n\n  config.app.env = config.app.env || {};\n  config.app.env['MONGO_URL'] = `mongodb://mongodb:27017/${config.app.name.split('.').join('')}`;\n\n  if (!config.app.docker) {\n    config.app.docker = {};\n  }\n\n  if (!config.app.docker.args) {\n    config.app.docker.args = [];\n  }\n\n  config.app.docker.args.push('--link=mongodb:mongodb');\n}\n\nexport const hooks = {\n  'post.default.setup'(api) {\n    const config = api.getConfig();\n    if (config.mongo) {\n      return api.runCommand('mongo.setup').then(() => api.runCommand('mongo.start'));\n    }\n  }\n};\n"]}